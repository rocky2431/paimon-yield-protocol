{
  "version": "4.0",
  "created": "2025-11-22 14:30:00",
  "project": "Paimon Yield Protocol",
  "total_estimated_days": "70-98",
  "tasks": [
    {
      "id": "1",
      "title": "初始化项目仓库和单体结构",
      "description": "创建 monorepo 结构,包含 contracts/, frontend/, backend/ 三个子项目。配置 pnpm workspace, Git 仓库,基础 README。",
      "complexity": 2,
      "priority": "P0",
      "dependencies": [],
      "estimated_days": 0.5,
      "status": "completed",
      "type": "architecture",
      "trace_to": "specs/architecture.md#3-technology-stack"
    },
    {
      "id": "2",
      "title": "配置 Foundry 智能合约开发环境",
      "description": "在 contracts/ 目录初始化 Foundry 项目。安装 OpenZeppelin 5.0, Solmate 依赖。配置 foundry.toml (BSC RPC, Gas 报告)。创建 src/, test/, script/ 目录结构。",
      "complexity": 3,
      "priority": "P0",
      "dependencies": ["1"],
      "estimated_days": 1,
      "status": "completed",
      "type": "architecture",
      "trace_to": "specs/architecture.md#31-smart-contract-stack"
    },
    {
      "id": "3",
      "title": "配置 Next.js 14 前端项目",
      "description": "使用 create-next-app 创建 Next.js 14 App Router 项目。安装 Wagmi, Viem, RainbowKit, Zustand。配置 TypeScript, Tailwind CSS。创建 app/, components/, lib/ 目录结构。",
      "complexity": 4,
      "priority": "P0",
      "dependencies": ["1"],
      "estimated_days": 1.5,
      "status": "completed",
      "type": "architecture",
      "trace_to": "specs/architecture.md#32-frontend-stack"
    },
    {
      "id": "4",
      "title": "配置 Node.js 后端项目 (Fastify)",
      "description": "在 backend/ 目录创建 Fastify 项目。安装 Fastify, Prisma, Bull, node-cron。配置 TypeScript, ESLint, Prettier。创建 src/routes/, src/services/, src/jobs/ 目录结构。",
      "complexity": 4,
      "priority": "P0",
      "dependencies": ["1"],
      "estimated_days": 1.5,
      "status": "completed",
      "type": "architecture",
      "trace_to": "specs/architecture.md#33-backend-stack"
    },
    {
      "id": "5",
      "title": "配置 PostgreSQL 和 Prisma ORM",
      "description": "安装 Prisma CLI。创建 prisma/schema.prisma。定义数据模型: User, Transaction, NetValue, RebalanceHistory。生成 Prisma Client。配置数据库连接 (.env)。运行初始 migration。",
      "complexity": 4,
      "priority": "P0",
      "dependencies": ["4"],
      "estimated_days": 1.5,
      "status": "completed",
      "type": "architecture",
      "trace_to": "specs/architecture.md#34-database-stack"
    },
    {
      "id": "6",
      "title": "配置 Redis 和 Bull Queue",
      "description": "安装 Redis (本地或 Railway)。配置 Bull Queue 用于后台任务 (通知、再平衡计算)。创建 src/jobs/queues.ts。测试 Redis 连接和任务调度。",
      "complexity": 3,
      "priority": "P1",
      "dependencies": ["4"],
      "estimated_days": 1,
      "status": "completed",
      "type": "architecture",
      "trace_to": "specs/architecture.md#33-backend-stack"
    },
    {
      "id": "7",
      "title": "配置 Vercel 和 Railway 部署",
      "description": "创建 Vercel 项目 (前端)。创建 Railway 项目 (后端 + PostgreSQL + Redis)。配置环境变量。设置自动部署 (Git push → 自动部署)。",
      "complexity": 4,
      "priority": "P1",
      "dependencies": ["3", "4"],
      "estimated_days": 2,
      "status": "completed",
      "type": "architecture",
      "trace_to": "specs/architecture.md#35-infrastructure-stack"
    },
    {
      "id": "8",
      "title": "配置 CI/CD 流水线 (GitHub Actions)",
      "description": "创建 .github/workflows/ci.yml。配置自动化流程: Lint → Test → Build。为 contracts/, frontend/, backend/ 分别配置测试脚本。配置 Foundry Gas 报告。",
      "complexity": 5,
      "priority": "P1",
      "dependencies": ["2", "3", "4"],
      "estimated_days": 2,
      "status": "completed",
      "type": "architecture",
      "trace_to": "specs/architecture.md#102-deployment-flow"
    },
    {
      "id": "9",
      "title": "编写开发环境文档",
      "description": "创建 docs/development-guide.md。记录本地开发环境设置、依赖安装、测试运行、部署流程。创建 docs/contributing.md (代码风格、提交规范)。",
      "complexity": 2,
      "priority": "P2",
      "dependencies": ["1", "2", "3", "4"],
      "estimated_days": 1,
      "status": "completed",
      "type": "architecture",
      "trace_to": "specs/architecture.md#2-architecture-principles"
    },
    {
      "id": "10",
      "title": "配置测试基础设施 (Foundry + Jest + Playwright)",
      "description": "配置 Foundry 测试框架 (单元测试、模糊测试、不变量测试)。配置 Jest (后端单元测试)。配置 Playwright (E2E 测试)。创建测试模板和辅助函数。",
      "complexity": 5,
      "priority": "P0",
      "dependencies": ["2", "3", "4"],
      "estimated_days": 2,
      "status": "completed",
      "type": "architecture",
      "trace_to": "specs/architecture.md#9-testing-strategy"
    },
    {
      "id": "11",
      "title": "实现 PNGYVault 基础合约 (ERC4626)",
      "description": "创建 PNGYVault.sol,继承 OpenZeppelin ERC4626, AccessControl, Pausable, ReentrancyGuard。实现 constructor,定义 ADMIN_ROLE, REBALANCER_ROLE。设置 asset (USDT) 和 name/symbol。",
      "complexity": 6,
      "priority": "P0",
      "dependencies": ["2", "10"],
      "estimated_days": 2,
      "status": "completed",
      "type": "feature",
      "trace_to": "specs/product.md#user-story-31-erc4626-标准接口实现"
    },
    {
      "id": "12",
      "title": "实现 PNGYVault deposit 和 mint 函数",
      "description": "实现 deposit(assets, receiver) 和 mint(shares, receiver)。添加最小存款检查 ($500)。添加 Gas 优化。编写单元测试 (正常存款、边界条件、失败情况)。",
      "complexity": 6,
      "priority": "P0",
      "dependencies": ["11"],
      "estimated_days": 2,
      "status": "completed",
      "type": "feature",
      "trace_to": "specs/product.md#user-story-12-存入-usdt-获取-pngy"
    },
    {
      "id": "13",
      "title": "实现 PNGYVault withdraw 和 redeem 函数",
      "description": "实现 withdraw(assets, receiver, owner) 和 redeem(shares, receiver, owner)。添加 T+1 赎回逻辑 (使用 withdrawQueue)。添加最大赎回限额检查 ($100K)。编写单元测试。",
      "complexity": 7,
      "priority": "P0",
      "dependencies": ["11"],
      "estimated_days": 3,
      "status": "completed",
      "type": "feature",
      "trace_to": "specs/product.md#user-story-14-赎回-pngy-获得-usdt"
    },
    {
      "id": "14",
      "title": "实现 PNGYVault totalAssets 聚合计算",
      "description": "实现 totalAssets() 函数,遍历 rwaAssets[] 数组,调用 OracleAdapter 获取每个资产价格,加权计算总价值。优化 Gas (使用缓存)。编写测试 (多资产场景)。",
      "complexity": 7,
      "priority": "P0",
      "dependencies": ["11", "21"],
      "estimated_days": 2,
      "status": "completed",
      "type": "feature",
      "trace_to": "specs/product.md#user-story-13-查看实时净值和收益"
    },
    {
      "id": "15",
      "title": "实现 PNGYVault pause/unpause 紧急机制",
      "description": "使用 OpenZeppelin Pausable。实现 pause() 和 unpause() 函数 (仅 ADMIN_ROLE)。暂停时禁止 deposit/withdraw。编写测试 (暂停状态下的操作失败)。",
      "complexity": 4,
      "priority": "P0",
      "dependencies": ["11"],
      "estimated_days": 1,
      "status": "completed",
      "type": "feature",
      "trace_to": "specs/product.md#user-story-42-暂停恢复合约"
    },
    {
      "id": "16",
      "title": "实现 PNGYVault Circuit Breaker 熔断机制",
      "description": "添加 circuitBreakerThreshold 状态变量 (默认 -5%)。添加 circuitBreakerActive 标志。在 withdraw 函数中检查净值下跌,触发熔断时限制单笔赎回金额 ($10K)。编写测试。",
      "complexity": 6,
      "priority": "P1",
      "dependencies": ["11", "14"],
      "estimated_days": 2,
      "status": "completed",
      "type": "feature",
      "trace_to": "specs/product.md#user-story-43-配置-circuit-breaker"
    },
    {
      "id": "17",
      "title": "编写 PNGYVault 完整单元测试套件",
      "description": "为 PNGYVault 编写完整测试: 正常存取款、边界条件 (0, max)、重入攻击、权限控制、暂停机制、熔断机制。使用 Foundry fuzz testing。目标覆盖率 100%。",
      "complexity": 8,
      "priority": "P0",
      "dependencies": ["12", "13", "14", "15", "16"],
      "estimated_days": 3,
      "status": "completed",
      "type": "feature",
      "trace_to": "specs/architecture.md#92-smart-contract-testing"
    },
    {
      "id": "18",
      "title": "实现 PNGYVault 不变量测试",
      "description": "使用 Foundry invariant testing。定义核心不变量: (1) totalAssets >= sum(user balances), (2) totalSupply 正确, (3) 净值单调不减 (除再平衡外)。编写 Invariant.t.sol。",
      "complexity": 7,
      "priority": "P1",
      "dependencies": ["17"],
      "estimated_days": 2,
      "status": "completed",
      "type": "feature",
      "trace_to": "specs/architecture.md#92-smart-contract-testing"
    },
    {
      "id": "19",
      "title": "实现 PNGYVault Gas 优化",
      "description": "优化 PNGYVault 合约 Gas 消耗: 使用 unchecked (安全情况下), 变量打包, immutable 变量, 短路逻辑。运行 forge gas-report。目标: deposit <150K Gas, withdraw <200K Gas。",
      "complexity": 6,
      "priority": "P1",
      "dependencies": ["17"],
      "estimated_days": 2,
      "status": "completed",
      "type": "feature",
      "trace_to": "specs/architecture.md#82-smart-contract-performance"
    },
    {
      "id": "20",
      "title": "编写 PNGYVault 集成文档和代码示例",
      "description": "创建 docs/integration-guide.md。说明 ERC4626 接口用法。提供 Solidity 集成示例 (DeFi 协议如何集成 PNGY)。提供 JavaScript/TypeScript SDK 示例。发布测试网合约地址和 ABI。",
      "complexity": 3,
      "priority": "P2",
      "dependencies": ["17"],
      "estimated_days": 1.5,
      "status": "pending",
      "type": "feature",
      "trace_to": "specs/product.md#user-story-32-提供集成文档和示例"
    },
    {
      "id": "21",
      "title": "实现 AssetRegistry 资产注册表合约",
      "description": "创建 AssetRegistry.sol。定义 RWAAsset struct (tokenAddress, name, symbol, assetType, oracleSource, isActive)。实现 registerAsset(), removeAsset(), getAllAssets()。添加 AccessControl (仅 ADMIN_ROLE)。编写单元测试。",
      "complexity": 5,
      "priority": "P0",
      "dependencies": ["2", "10"],
      "estimated_days": 2,
      "status": "completed",
      "type": "feature",
      "trace_to": "specs/product.md#user-story-61-集成-bsc-已有的-rwa-代币"
    },
    {
      "id": "22",
      "title": "实现 AssetRegistry 与 PNGYVault 集成",
      "description": "在 PNGYVault 添加 assetRegistry 状态变量。实现 addRWAAsset(address, targetAllocation) 函数,从 AssetRegistry 读取资产信息并添加到 rwaAssets[]。实现 removeRWAAsset(address)。编写集成测试。",
      "complexity": 6,
      "priority": "P0",
      "dependencies": ["11", "21"],
      "estimated_days": 2,
      "status": "completed",
      "type": "feature",
      "trace_to": "specs/product.md#user-story-61-集成-bsc-已有的-rwa-代币"
    },
    {
      "id": "23",
      "title": "实现 SwapHelper DEX 集成合约",
      "description": "创建 SwapHelper.sol。封装 PancakeSwap Router V2 接口。实现 buyRWAAsset(tokenIn, tokenOut, amountIn, maxSlippage) 和 sellRWAAsset()。添加滑点保护 (最大 2%)。编写测试 (使用 Mock Router)。",
      "complexity": 7,
      "priority": "P0",
      "dependencies": ["2", "10"],
      "estimated_days": 3,
      "status": "completed",
      "type": "feature",
      "trace_to": "specs/product.md#user-story-65-测试-rwa-资产买卖流程"
    },
    {
      "id": "24",
      "title": "在 PNGYVault 集成 SwapHelper",
      "description": "在 PNGYVault 的 deposit 函数中,使用 SwapHelper 将 USDT 购买 RWA 代币 (按 targetAllocations 配比)。在 withdraw 函数中,卖出 RWA 代币换回 USDT。处理滑点过高的异常情况。编写集成测试。",
      "complexity": 7,
      "priority": "P0",
      "dependencies": ["12", "13", "23"],
      "estimated_days": 3,
      "status": "completed",
      "type": "feature",
      "trace_to": "specs/product.md#user-story-12-存入-usdt-获取-pngy"
    },
    {
      "id": "25",
      "title": "实现 RWA 资产审核和移除功能",
      "description": "在 AssetRegistry 添加 markAssetForRemoval(address) 函数。在 PNGYVault 实现 removeRWAAssetWithLiquidation(address),先卖出该资产换回 USDT,再从 rwaAssets[] 移除。需要多签批准。编写测试。",
      "complexity": 6,
      "priority": "P1",
      "dependencies": ["22", "24"],
      "estimated_days": 2,
      "status": "completed",
      "type": "feature",
      "trace_to": "specs/product.md#user-story-62-审核和移除-rwa-资产"
    },
    {
      "id": "26",
      "title": "在 BSC 测试网测试 RWA 资产买卖流程",
      "description": "部署 PNGYVault 到 BSC 测试网。部署 Mock RWA 代币合约。测试完整流程: 注册资产 → 购买 RWA 代币 (通过 DEX 或 Mock) → 存款 → 赎回 → 卖出 RWA。测试不同金额的滑点 ($1K/$10K/$100K)。记录 Gas 费。",
      "complexity": 8,
      "priority": "P0",
      "dependencies": ["24"],
      "estimated_days": 2,
      "status": "completed",
      "type": "feature",
      "trace_to": "specs/product.md#user-story-65-测试-rwa-资产买卖流程"
    },
    {
      "id": "31",
      "title": "实现 OracleAdapter 双 Oracle 架构合约",
      "description": "创建 OracleAdapter.sol。定义 IOracleAdapter 接口。支持 APRO (API3) 和 Chainlink 双 Oracle。实现 getPrice(address asset),自动故障切换逻辑 (数据过期 >2 小时切换到备用 Oracle)。编写单元测试。",
      "complexity": 7,
      "priority": "P0",
      "dependencies": ["2", "10"],
      "estimated_days": 3,
      "status": "completed",
      "type": "feature",
      "trace_to": "specs/product.md#user-story-64-配置-rwa-资产-oracle-数据源"
    },
    {
      "id": "32",
      "title": "集成 APRO (API3) Oracle",
      "description": "在 OracleAdapter 集成 APRO dAPI。配置 BSC 上的 APRO proxy 地址。实现 _getAPROPrice(address asset)。测试价格获取和数据更新频率。处理 Oracle 返回 0 或过期数据的情况。",
      "complexity": 6,
      "priority": "P0",
      "dependencies": ["31"],
      "estimated_days": 2,
      "status": "completed",
      "type": "feature",
      "trace_to": "specs/product.md#user-story-64-配置-rwa-资产-oracle-数据源"
    },
    {
      "id": "33",
      "title": "集成 Chainlink Price Feed (备用 Oracle)",
      "description": "在 OracleAdapter 集成 Chainlink Price Feed。配置 BSC 上的 Chainlink aggregator 地址。实现 _getChainlinkPrice(address asset)。测试故障切换逻辑 (APRO 失效时自动切换)。编写集成测试。",
      "complexity": 6,
      "priority": "P0",
      "dependencies": ["31"],
      "estimated_days": 2,
      "status": "completed",
      "type": "feature",
      "trace_to": "specs/product.md#user-story-64-配置-rwa-资产-oracle-数据源"
    },
    {
      "id": "34",
      "title": "实现 RebalanceStrategy 动态再平衡合约",
      "description": "创建 RebalanceStrategy.sol。实现 calculateOptimalAllocation(RWAAsset[] assets) 函数,根据每个资产的 APY 计算最优配比。实现 generateRebalanceTx(currentAllocations, targetAllocations),生成买卖交易参数。编写单元测试。",
      "complexity": 8,
      "priority": "P1",
      "dependencies": ["2", "10"],
      "estimated_days": 3,
      "status": "completed",
      "type": "feature",
      "trace_to": "specs/product.md#user-story-41-执行动态再平衡"
    },
    {
      "id": "35",
      "title": "在 PNGYVault 实现 rebalance 函数",
      "description": "在 PNGYVault 添加 rebalance(address[] sellAssets, uint[] sellAmounts, address[] buyAssets, uint[] buyAmounts) 函数。仅 REBALANCER_ROLE 可调用。执行资产买卖 (通过 SwapHelper)。更新 targetAllocations。触发 RebalanceExecuted 事件。需要多签批准。编写测试。",
      "complexity": 8,
      "priority": "P1",
      "dependencies": ["11", "24", "34"],
      "estimated_days": 3,
      "status": "completed",
      "type": "feature",
      "trace_to": "specs/product.md#user-story-41-执行动态再平衡"
    },
    {
      "id": "36",
      "title": "集成 Gnosis Safe 多签治理",
      "description": "配置 Gnosis Safe (3/5 多签)。将 PNGYVault 的 ADMIN_ROLE 和 REBALANCER_ROLE 赋予 Gnosis Safe 地址。测试多签批准流程: 提交交易 → 3/5 签名 → 执行。编写脚本简化多签操作。",
      "complexity": 6,
      "priority": "P0",
      "dependencies": ["11"],
      "estimated_days": 2,
      "status": "completed",
      "type": "feature",
      "trace_to": "specs/product.md#user-story-44-多签治理操作"
    },
    {
      "id": "37",
      "title": "编写智能合约部署脚本",
      "description": "创建 script/Deploy.s.sol。部署顺序: AssetRegistry → OracleAdapter → SwapHelper → RebalanceStrategy → PNGYVault。配置初始参数 (USDT 地址, Gnosis Safe 地址, Oracle 地址)。测试部署到 BSC 测试网。",
      "complexity": 5,
      "priority": "P0",
      "dependencies": ["11", "21", "23", "31", "34"],
      "estimated_days": 2,
      "status": "completed",
      "type": "architecture",
      "trace_to": "specs/architecture.md#102-deployment-flow"
    },
    {
      "id": "38",
      "title": "准备智能合约审计材料",
      "description": "整理所有智能合约代码。编写 docs/audit-scope.md (审计范围、核心逻辑说明、已知风险)。导出测试覆盖率报告。导出 Gas 报告。准备 Slither/Mythril 静态分析报告。",
      "complexity": 4,
      "priority": "P1",
      "dependencies": ["17", "19", "26"],
      "estimated_days": 2,
      "status": "pending",
      "type": "feature",
      "trace_to": "specs/architecture.md#74-smart-contract-security"
    },
    {
      "id": "41",
      "title": "实现钱包连接功能 (Reown AppKit)",
      "description": "配置 Reown AppKit + Wagmi。创建 components/WalletConnect.tsx。支持 MetaMask, Trust Wallet, WalletConnect。显示连接的钱包地址和 USDT 余额。添加网络检查 (BSC 主网/测试网)。断开连接功能。编写组件测试。",
      "complexity": 4,
      "priority": "P0",
      "dependencies": ["3"],
      "estimated_days": 1.5,
      "status": "completed",
      "type": "feature",
      "trace_to": "specs/product.md#user-story-11-连接钱包"
    },
    {
      "id": "42",
      "title": "实现存款 UI 组件",
      "description": "创建 components/DepositForm.tsx。输入存款金额 (最低 $500)。预览预期获得的 PNGY 数量 (调用 previewDeposit)。显示 Gas 费预估。实现 USDT 授权 (approve) 和 deposit 交易。显示交易状态 (pending/success/error)。编写组件测试。",
      "complexity": 6,
      "priority": "P0",
      "dependencies": ["3", "41"],
      "estimated_days": 2.5,
      "status": "completed",
      "type": "feature",
      "trace_to": "specs/product.md#user-story-12-存入-usdt-获取-pngy"
    },
    {
      "id": "43",
      "title": "实现赎回 UI 组件",
      "description": "创建 components/WithdrawForm.tsx。输入赎回的 PNGY 数量。预览预期获得的 USDT 金额 (调用 previewRedeem)。显示 T+1 到账提示。实现 withdraw 交易。显示交易状态和赎回队列信息。编写组件测试。",
      "complexity": 6,
      "priority": "P0",
      "dependencies": ["3", "41"],
      "estimated_days": 2.5,
      "status": "completed",
      "type": "feature",
      "trace_to": "specs/product.md#user-story-14-赎回-pngy-获得-usdt"
    },
    {
      "id": "44",
      "title": "实现仪表板 - 净值和收益展示",
      "description": "创建 app/dashboard/page.tsx 和 components/Dashboard.tsx。显示 PNGY 当前净值、用户 PNGY 余额、总资产价值、累计收益和收益率。数据每 5 分钟自动刷新。使用 Zustand 状态管理。编写组件测试。",
      "complexity": 5,
      "priority": "P0",
      "dependencies": ["3", "41"],
      "estimated_days": 2,
      "status": "completed",
      "type": "feature",
      "trace_to": "specs/product.md#user-story-13-查看实时净值和收益"
    },
    {
      "id": "45",
      "title": "实现交易历史页面",
      "description": "创建 app/history/page.tsx。从后端 API 获取交易历史 (存款、赎回)。显示表格: 时间、类型、金额、状态。支持按时间筛选 (7/30/全部天)。支持导出 CSV。点击交易查看 BSCScan 详情。编写组件测试。",
      "complexity": 5,
      "priority": "P0",
      "dependencies": ["3", "41"],
      "estimated_days": 2,
      "status": "completed",
      "type": "feature",
      "trace_to": "specs/product.md#user-story-15-查看交易历史记录"
    },
    {
      "id": "46",
      "title": "实现历史收益曲线图表",
      "description": "创建 components/PerformanceChart.tsx。使用 Recharts 或 Chart.js。从后端 API 获取历史净值数据 (7/30/90 天)。折线图展示 PNGY 净值历史和 APY 趋势。标注关键事件 (再平衡)。支持导出数据。编写组件测试。",
      "complexity": 6,
      "priority": "P1",
      "dependencies": ["3"],
      "estimated_days": 2.5,
      "status": "completed",
      "type": "feature",
      "trace_to": "specs/product.md#user-story-21-查看历史收益曲线"
    },
    {
      "id": "47",
      "title": "实现 RWA 资产配置展示",
      "description": "创建 components/AssetAllocation.tsx。从智能合约或后端 API 获取 RWA 资产配置数据。饼图或柱状图展示资产配比。显示每种资产的当前 APY、质量评级、最近再平衡时间。编写组件测试。",
      "complexity": 5,
      "priority": "P1",
      "dependencies": ["3"],
      "estimated_days": 2,
      "status": "completed",
      "type": "feature",
      "trace_to": "specs/product.md#user-story-22-查看-rwa-资产配置"
    },
    {
      "id": "48",
      "title": "实现 RWA 资产详情页面",
      "description": "创建 app/assets/page.tsx。调用 AssetRegistry.getAllAssets() 获取资产列表。显示每个 RWA 资产的: 名称、项目方链接、当前 APY、Vault 持有量、目标配比 vs 实际配比、底层资产类型、审计报告。编写组件测试。",
      "complexity": 5,
      "priority": "P1",
      "dependencies": ["3", "41"],
      "estimated_days": 2,
      "status": "in_progress",
      "type": "feature",
      "trace_to": "specs/product.md#user-story-63-查看-rwa-资产详情"
    },
    {
      "id": "49",
      "title": "实现前端通知系统 (浏览器通知)",
      "description": "使用 Notification API。创建 lib/notifications.ts。实现通知权限请求。监听合约事件 (RebalanceExecuted, EmergencyPause, CircuitBreakerTriggered)。显示浏览器通知。创建通知历史记录页面。编写测试。",
      "complexity": 6,
      "priority": "P1",
      "dependencies": ["3"],
      "estimated_days": 2.5,
      "status": "pending",
      "type": "feature",
      "trace_to": "specs/product.md#user-story-16-接收通知赎回到账再平衡"
    },
    {
      "id": "50",
      "title": "前端性能优化 - Core Web Vitals",
      "description": "优化 LCP (<2.5s): 图片懒加载、关键资源预加载。优化 INP (<200ms): 防抖、虚拟滚动。优化 CLS (<0.1): 固定元素尺寸、骨架屏。使用 Next.js Image 组件。配置 Vercel Analytics。运行 Lighthouse 测试。",
      "complexity": 7,
      "priority": "P1",
      "dependencies": ["42", "43", "44", "45"],
      "estimated_days": 3,
      "status": "pending",
      "type": "feature",
      "trace_to": "specs/architecture.md#81-frontend-performance"
    },
    {
      "id": "51",
      "title": "实现后端 API - 获取用户交易历史",
      "description": "创建 backend/src/routes/transactions.ts。实现 GET /api/transactions/:address。从 PostgreSQL 查询用户的存款和赎回记录。支持分页和时间筛选。返回 JSON 格式数据。编写单元测试和集成测试。",
      "complexity": 5,
      "priority": "P0",
      "dependencies": ["4", "5"],
      "estimated_days": 2,
      "status": "pending",
      "type": "feature",
      "trace_to": "specs/product.md#user-story-15-查看交易历史记录"
    },
    {
      "id": "52",
      "title": "实现后端 API - 获取历史净值数据",
      "description": "创建 backend/src/routes/netvalue.ts。实现 GET /api/netvalue?days=30。从 PostgreSQL NetValue 表查询历史净值数据。支持时间范围筛选 (7/30/90 天)。返回 JSON 格式 (timestamp, netvalue, apy)。编写测试。",
      "complexity": 4,
      "priority": "P1",
      "dependencies": ["4", "5"],
      "estimated_days": 1.5,
      "status": "pending",
      "type": "feature",
      "trace_to": "specs/product.md#user-story-21-查看历史收益曲线"
    },
    {
      "id": "53",
      "title": "实现后端 API - 获取 RWA 资产配置数据",
      "description": "创建 backend/src/routes/assets.ts。实现 GET /api/assets/allocation。从智能合约读取 rwaAssets[] 和 targetAllocations。从 Oracle 获取实时 APY。返回 JSON 格式 (资产名称、配比、APY、持有量)。编写测试。",
      "complexity": 5,
      "priority": "P1",
      "dependencies": ["4"],
      "estimated_days": 2,
      "status": "pending",
      "type": "feature",
      "trace_to": "specs/product.md#user-story-22-查看-rwa-资产配置"
    },
    {
      "id": "54",
      "title": "实现后端事件监听器 - 记录链上交易",
      "description": "创建 backend/src/services/eventListener.ts。监听 PNGYVault 合约事件 (Deposit, Withdraw, RebalanceExecuted)。解析事件日志,插入到 PostgreSQL Transaction 表。处理链重组情况。编写测试。",
      "complexity": 6,
      "priority": "P0",
      "dependencies": ["4", "5"],
      "estimated_days": 2.5,
      "status": "pending",
      "type": "feature",
      "trace_to": "specs/architecture.md#43-backend-components"
    },
    {
      "id": "55",
      "title": "实现后端定时任务 - 净值计算和存储",
      "description": "创建 backend/src/jobs/calculateNetValue.ts。使用 node-cron 每小时触发。调用 Oracle 获取 RWA 资产价格。计算 totalAssets 和 PNGY 净值 (NAV)。插入到 PostgreSQL NetValue 表。编写测试。",
      "complexity": 6,
      "priority": "P0",
      "dependencies": ["4", "5", "6"],
      "estimated_days": 2.5,
      "status": "pending",
      "type": "feature",
      "trace_to": "specs/architecture.md#13-data-flow-overview"
    },
    {
      "id": "56",
      "title": "实现通知系统 - 邮件通知 (可选)",
      "description": "集成 SendGrid 或 Resend。创建 backend/src/services/emailService.ts。实现通知模板 (赎回到账、资产再平衡、紧急暂停)。用户可在前端配置邮件通知偏好 (保存到 PostgreSQL)。编写测试。",
      "complexity": 6,
      "priority": "P1",
      "dependencies": ["4", "5"],
      "estimated_days": 3,
      "status": "pending",
      "type": "feature",
      "trace_to": "specs/product.md#user-story-16-接收通知赎回到账再平衡"
    },
    {
      "id": "57",
      "title": "实现通知系统 - Bull Queue 后台任务",
      "description": "创建 backend/src/jobs/notificationQueue.ts。使用 Bull Queue 处理通知发送任务 (邮件、推送)。监听合约事件,将通知任务加入队列。实现重试机制 (最多 3 次)。编写测试。",
      "complexity": 6,
      "priority": "P1",
      "dependencies": ["6", "56"],
      "estimated_days": 2,
      "status": "pending",
      "type": "feature",
      "trace_to": "specs/product.md#user-story-16-接收通知赎回到账再平衡"
    },
    {
      "id": "58",
      "title": "实现 B2B 定制化报表导出",
      "description": "创建 backend/src/routes/reports.ts。实现 GET /api/reports/export?format=csv。从 PostgreSQL 查询用户的交易历史、净值变化、收益明细。生成 CSV 格式报表。支持自定义时间范围。编写测试。",
      "complexity": 5,
      "priority": "P2",
      "dependencies": ["4", "5"],
      "estimated_days": 2,
      "status": "pending",
      "type": "feature",
      "trace_to": "specs/product.md#user-story-51-b2b-定制化报表"
    },
    {
      "id": "59",
      "title": "实现大额赎回优先通道",
      "description": "在 backend/src/services/withdrawService.ts 检测大额赎回 (≥$100K)。提前通知协议管理员 (Telegram/邮件)。在 PostgreSQL 记录大额赎回请求,优先处理 (T+0.5 目标)。前端显示大额赎回状态。编写测试。",
      "complexity": 6,
      "priority": "P2",
      "dependencies": ["4", "5"],
      "estimated_days": 2.5,
      "status": "pending",
      "type": "feature",
      "trace_to": "specs/product.md#user-story-52-大额赎回优先通道"
    },
    {
      "id": "60",
      "title": "实现链下再平衡引擎",
      "description": "创建 backend/src/services/rebalanceEngine.ts。定时检查 RWA 资产 APY 变化 (每日)。调用 RebalanceStrategy.calculateOptimalAllocation() 计算最优配比。如果配比偏差 >5%,生成再平衡交易参数。提交到 Gnosis Safe 多签。编写测试。",
      "complexity": 8,
      "priority": "P1",
      "dependencies": ["4", "34", "36"],
      "estimated_days": 3,
      "status": "pending",
      "type": "feature",
      "trace_to": "specs/product.md#user-story-41-执行动态再平衡"
    },
    {
      "id": "71",
      "title": "编写智能合约单元测试 (目标覆盖率 100%)",
      "description": "为所有智能合约编写完整的单元测试。使用 Foundry 测试框架。覆盖正常流程、边界条件、异常情况、权限控制。运行 forge coverage,确保覆盖率 ≥95%。修复未覆盖的分支。",
      "complexity": 8,
      "priority": "P0",
      "dependencies": ["17", "21", "23", "31", "34"],
      "estimated_days": 4,
      "status": "pending",
      "type": "feature",
      "trace_to": "specs/architecture.md#92-smart-contract-testing"
    },
    {
      "id": "72",
      "title": "编写智能合约集成测试",
      "description": "创建 test/integration/ 目录。编写端到端测试: 完整存款流程 (授权 → deposit → 购买 RWA)、完整赎回流程 (withdraw → 卖出 RWA)、再平衡流程、Oracle 故障切换。使用 Foundry fork 测试 (BSC 测试网)。",
      "complexity": 8,
      "priority": "P0",
      "dependencies": ["26", "71"],
      "estimated_days": 3,
      "status": "pending",
      "type": "feature",
      "trace_to": "specs/architecture.md#92-smart-contract-testing"
    },
    {
      "id": "73",
      "title": "编写前端单元测试 (Jest + React Testing Library)",
      "description": "为所有前端组件编写单元测试。测试组件渲染、用户交互、状态管理、API 调用 (使用 mock)。运行 jest --coverage,确保覆盖率 ≥80%。",
      "complexity": 7,
      "priority": "P1",
      "dependencies": ["42", "43", "44", "45", "46", "47"],
      "estimated_days": 3,
      "status": "pending",
      "type": "feature",
      "trace_to": "specs/architecture.md#93-frontend-testing"
    },
    {
      "id": "74",
      "title": "编写 E2E 测试 (Playwright)",
      "description": "使用 Playwright 编写端到端测试。场景: (1) 用户首次存款流程, (2) 查看仪表板和收益, (3) 赎回流程, (4) 查看交易历史。使用 Synpress (Web3 E2E) 测试钱包连接和交易。在 CI 中运行。",
      "complexity": 8,
      "priority": "P1",
      "dependencies": ["42", "43", "44", "45"],
      "estimated_days": 4,
      "status": "pending",
      "type": "feature",
      "trace_to": "specs/architecture.md#93-frontend-testing"
    },
    {
      "id": "75",
      "title": "编写后端单元测试和集成测试",
      "description": "为所有后端 API 和服务编写单元测试 (Jest)。测试 API 路由、数据库操作、事件监听器、定时任务。使用 Supertest 进行 API 集成测试。确保覆盖率 ≥80%。",
      "complexity": 7,
      "priority": "P1",
      "dependencies": ["51", "52", "53", "54", "55"],
      "estimated_days": 3,
      "status": "pending",
      "type": "feature",
      "trace_to": "specs/architecture.md#91-test-pyramid"
    },
    {
      "id": "76",
      "title": "运行安全审计工具 (Slither + Mythril)",
      "description": "运行 Slither 静态分析工具,检测智能合约漏洞。运行 Mythril 符号执行工具。修复所有 High/Medium 级别问题。生成审计报告。记录 Low 级别问题和缓解措施。",
      "complexity": 6,
      "priority": "P0",
      "dependencies": ["71", "72"],
      "estimated_days": 2,
      "status": "pending",
      "type": "feature",
      "trace_to": "specs/architecture.md#74-smart-contract-security"
    },
    {
      "id": "77",
      "title": "联系审计公司并启动审计",
      "description": "联系 Trail of Bits 或 OpenZeppelin 审计公司。提交审计材料 (代码、测试、文档)。配合审计过程,回答问题,提供补充信息。预计审计时间 4-6 周。预算 $80K-$150K。",
      "complexity": 4,
      "priority": "P0",
      "dependencies": ["38", "76"],
      "estimated_days": 1,
      "status": "pending",
      "type": "feature",
      "trace_to": "specs/architecture.md#74-smart-contract-security"
    },
    {
      "id": "78",
      "title": "修复审计发现的漏洞",
      "description": "根据审计报告修复所有 Critical/High 级别漏洞。重新运行测试,确保修复未引入新问题。更新代码和文档。提交给审计公司复审。获得最终审计报告。",
      "complexity": 7,
      "priority": "P0",
      "dependencies": ["77"],
      "estimated_days": 3,
      "status": "pending",
      "type": "bugfix",
      "trace_to": "specs/architecture.md#74-smart-contract-security"
    },
    {
      "id": "81",
      "title": "部署智能合约到 BSC 测试网",
      "description": "使用 script/Deploy.s.sol 部署所有合约到 BSC 测试网。配置初始参数。验证合约源码 (BSCScan)。记录合约地址到 docs/deployments.md。测试合约交互 (通过前端和 Foundry 脚本)。",
      "complexity": 5,
      "priority": "P0",
      "dependencies": ["37", "72"],
      "estimated_days": 1.5,
      "status": "pending",
      "type": "architecture",
      "trace_to": "specs/architecture.md#102-deployment-flow"
    },
    {
      "id": "82",
      "title": "部署前端到 Vercel (Staging 环境)",
      "description": "创建 Vercel 项目,连接 GitHub 仓库。配置环境变量 (测试网 RPC, 合约地址)。部署 staging 分支。测试前端功能 (连接钱包、存款、赎回)。配置自定义域名 (staging.paimon.finance)。",
      "complexity": 4,
      "priority": "P0",
      "dependencies": ["7", "50", "74"],
      "estimated_days": 1.5,
      "status": "pending",
      "type": "architecture",
      "trace_to": "specs/architecture.md#102-deployment-flow"
    },
    {
      "id": "83",
      "title": "部署后端到 Railway (Staging 环境)",
      "description": "创建 Railway 项目 (后端 + PostgreSQL + Redis)。配置环境变量。部署 staging 分支。运行数据库 migration (Prisma migrate deploy)。测试 API 端点和后台任务。配置健康检查。",
      "complexity": 5,
      "priority": "P0",
      "dependencies": ["7", "75"],
      "estimated_days": 2,
      "status": "pending",
      "type": "architecture",
      "trace_to": "specs/architecture.md#102-deployment-flow"
    },
    {
      "id": "84",
      "title": "执行 Staging 环境全面测试",
      "description": "在 staging 环境执行完整测试: 钱包连接、存款、赎回、查看历史、通知系统、再平衡流程。邀请内部团队和少量外部用户测试。收集反馈和 bug 报告。修复发现的问题。",
      "complexity": 7,
      "priority": "P0",
      "dependencies": ["81", "82", "83"],
      "estimated_days": 3,
      "status": "pending",
      "type": "feature",
      "trace_to": "specs/architecture.md#101-environments"
    },
    {
      "id": "85",
      "title": "配置监控和告警系统",
      "description": "配置 Sentry (前端和后端错误监控)。配置 Uptime Robot (后端健康检查)。配置 Vercel Analytics (前端性能)。配置 Grafana + Prometheus (服务器监控,可选)。设置告警规则,通知到 Slack/Telegram。",
      "complexity": 5,
      "priority": "P1",
      "dependencies": ["82", "83"],
      "estimated_days": 2,
      "status": "pending",
      "type": "architecture",
      "trace_to": "specs/architecture.md#35-infrastructure-stack"
    },
    {
      "id": "86",
      "title": "部署智能合约到 BSC 主网",
      "description": "最终安全检查 (审计通过、测试覆盖率、主网配置)。使用 script/Deploy.s.sol 部署到 BSC 主网。使用 Gnosis Safe 多签执行部署。验证合约源码。记录合约地址。公告合约部署。",
      "complexity": 6,
      "priority": "P0",
      "dependencies": ["78", "84"],
      "estimated_days": 2,
      "status": "pending",
      "type": "architecture",
      "trace_to": "specs/architecture.md#102-deployment-flow"
    },
    {
      "id": "87",
      "title": "部署前端到 Vercel (Production 环境)",
      "description": "配置 production 分支。更新环境变量 (主网 RPC, 主网合约地址)。部署到 Vercel production。测试主网前端。配置自定义域名 (app.paimon.finance)。配置 CDN 和缓存策略。",
      "complexity": 4,
      "priority": "P0",
      "dependencies": ["86"],
      "estimated_days": 1,
      "status": "pending",
      "type": "architecture",
      "trace_to": "specs/architecture.md#102-deployment-flow"
    },
    {
      "id": "88",
      "title": "部署后端到 Railway (Production 环境)",
      "description": "配置 production 分支。更新环境变量 (主网 RPC, 主网合约地址, 生产数据库)。部署到 Railway production。运行生产数据库 migration。测试主网 API 和后台任务。配置自动备份。",
      "complexity": 5,
      "priority": "P0",
      "dependencies": ["86"],
      "estimated_days": 1.5,
      "status": "pending",
      "type": "architecture",
      "trace_to": "specs/architecture.md#102-deployment-flow"
    },
    {
      "id": "89",
      "title": "启动 Bug Bounty 计划 (Immunefi)",
      "description": "在 Immunefi 或 Code4rena 创建 Bug Bounty 项目。设置奖励额度 (Critical $50K-$500K, High $10K-$50K, Medium $1K-$10K)。公开智能合约代码和审计报告。预留 $100K 储备金。",
      "complexity": 4,
      "priority": "P0",
      "dependencies": ["86"],
      "estimated_days": 1,
      "status": "pending",
      "type": "feature",
      "trace_to": "specs/architecture.md#74-smart-contract-security"
    },
    {
      "id": "90",
      "title": "执行 Production 环境最终测试",
      "description": "在主网执行小额真实资金测试 (团队成员存入 $500-$1000)。验证完整流程: 存款 → 查看净值 → 赎回 → 通知。监控 Gas 费、交易确认时间、系统性能。确认无问题后向公众开放。",
      "complexity": 7,
      "priority": "P0",
      "dependencies": ["87", "88"],
      "estimated_days": 2,
      "status": "pending",
      "type": "feature",
      "trace_to": "specs/architecture.md#101-environments"
    },
    {
      "id": "91",
      "title": "编写用户文档和 FAQ",
      "description": "创建 docs/user-guide.md (如何连接钱包、存款、赎回、查看收益)。创建 docs/faq.md (常见问题、T+1 赎回说明、手续费、风险提示)。创建新手引导视频或动画。发布到官网。",
      "complexity": 4,
      "priority": "P1",
      "dependencies": ["90"],
      "estimated_days": 2,
      "status": "pending",
      "type": "feature",
      "trace_to": "specs/product.md#33-key-user-scenarios"
    },
    {
      "id": "92",
      "title": "准备营销材料和官网",
      "description": "设计官网 (Next.js)。内容: 产品介绍、RWA 资产说明、团队介绍、审计报告链接、FAQ。创建 Twitter/Discord 社区。准备宣传文案、海报、视频。",
      "complexity": 6,
      "priority": "P1",
      "dependencies": ["90"],
      "estimated_days": 3,
      "status": "pending",
      "type": "feature",
      "trace_to": "specs/product.md#21-primary-user-segments"
    },
    {
      "id": "93",
      "title": "执行正式发布和公告",
      "description": "公告主网上线: Twitter, Discord, Reddit, Medium。发布审计报告和合约地址。发布用户指南和 FAQ。启动 Bug Bounty。监控前 24 小时用户活动和系统状态。准备快速响应团队。",
      "complexity": 5,
      "priority": "P0",
      "dependencies": ["90", "91", "92"],
      "estimated_days": 1,
      "status": "pending",
      "type": "feature",
      "trace_to": "specs/product.md#11-core-problem"
    },
    {
      "id": "94",
      "title": "实现推荐奖励系统 (Post-MVP)",
      "description": "创建推荐码生成逻辑 (链下或链上)。在智能合约添加 referral 参数到 deposit 函数。新用户首次存款后,自动发放推荐奖励 (如 0.5% 返佣) 到推荐人。前端显示推荐统计。编写测试。",
      "complexity": 7,
      "priority": "P2",
      "dependencies": ["12", "90"],
      "estimated_days": 3.5,
      "status": "pending",
      "type": "feature",
      "trace_to": "specs/product.md#user-story-71-推荐奖励系统"
    },
    {
      "id": "95",
      "title": "MVP 交付后的回顾和优化",
      "description": "组织团队回顾会议。收集用户反馈。分析系统性能数据 (Gas 费、响应时间、错误率)。识别优化机会。规划 Post-MVP 功能 (跨链、AI 再平衡)。更新技术债务清单。",
      "complexity": 3,
      "priority": "P1",
      "dependencies": ["93"],
      "estimated_days": 2,
      "status": "pending",
      "type": "architecture",
      "trace_to": "specs/architecture.md#2-architecture-principles"
    }
  ],
  "summary": {
    "total_tasks": 95,
    "priority_distribution": {
      "P0": 51,
      "P1": 33,
      "P2": 11
    },
    "complexity_distribution": {
      "low_1_3": 8,
      "medium_4_6": 56,
      "high_7_10": 31
    },
    "type_distribution": {
      "architecture": 15,
      "feature": 77,
      "bugfix": 3
    },
    "estimated_total_days": "70-98 days",
    "parallel_opportunities": "Tasks 2-4 can run in parallel (infrastructure setup), Tasks 11-36 have multiple parallel paths (smart contract development), Tasks 41-49 can run in parallel (frontend development)",
    "critical_path": "1 → 2 → 10 → 11 → 12 → 13 → 14 → 17 → 71 → 72 → 76 → 77 → 78 → 81 → 84 → 86 → 90 → 93",
    "traceability": {
      "tasks_with_trace_to": 95,
      "percentage": "100%",
      "specification_coverage": "All 19 User Stories covered + Architecture sections covered"
    }
  }
}
